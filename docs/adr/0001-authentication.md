# 0001: Keycloak OIDC + ローカル管理者フォールバックの採用

## 背景
- 認証方式が未整備であり、外部 IdP 連携を追加したい。
- Keycloak 障害時でも運用継続のため最低限のログイン経路を残す必要がある。

## 決定
- IdP は Keycloak を使用し、OIDC（Authorization Code フロー）でログインする。
- 自動フェイルオーバーは行わず、ログイン画面で利用者が経路を選択する。
- Keycloak 障害（HTTP 5xx/タイムアウト）時はエラーを表示し、ローカル管理者ログインに切り替えられるよう案内する。
- ローカル経路は管理者専用で、`SOKORA_LOCAL_ADMIN_USERNAME/PASSWORD` の組でのみ許可する。
- ユーザー識別子は Keycloak の `sub` をセッションに格納し、`preferred_username` を表示用として保持する。現時点ではアプリ内 `users` テーブルとは紐付けない。
- セッションはサーバーサイドセッションで管理し、デフォルト有効期限は 1 時間。リフレッシュトークンは保持せず、期限切れ時は再ログインさせる。
- OIDC 設定は `.env` の `OIDC_*` で管理し、OIDC 有効/無効はローカル管理者専用ページでトグルし、状態はファイルで保持する。

## 影響
- docs: requirements (API/UI) に認証要件を追記。
- app: 認証ルーター/ガード/セッション管理を追加し、Keycloak とローカル管理者の両経路を UI 上で提供する。
- config: OIDC とローカル管理者、セッション関連の環境変数を追加する。
