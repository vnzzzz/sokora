<!DOCTYPE html>
<html lang="ja" x-data class="bg-base-100">

{% set title_text = user_name + " (" + user_id + ") の勤怠編集 - Sokora" %}
{% include "components/head.html" %}

<body class="min-h-screen bg-base-100">
  <!-- テーマ切り替えボタン -->
  {% include "components/theme_switcher.html" %}

  <!-- ヘッダー -->
  {% include "components/navbar.html" %}

  <!-- メインコンテンツ -->
  <main class="container mx-auto p-4 space-y-6">
    <div class="card bg-base-200 shadow-sm">
      <div class="card-body">
        <div class="flex justify-between items-center">
          <div>
            <h2 class="text-2xl font-bold mb-1">{{ user_name }} ({{ user_id }}) の勤怠編集</h2>
            <div class="text-sm breadcrumbs">
              <ul>
                <li><a href="/attendance">勤怠入力</a></li>
                <li>{{ user_name }} ({{ user_id }})</li>
              </ul>
            </div>
          </div>
          <div class="btn-group">
            <a href="/attendance/edit/{{ user_id }}?month={{ prev_month }}" class="btn btn-outline btn-sm">前月</a>
            <a href="/attendance/edit/{{ user_id }}" class="btn btn-outline btn-sm">今月</a>
            <a href="/attendance/edit/{{ user_id }}?month={{ next_month }}" class="btn btn-outline btn-sm">翌月</a>
          </div>
        </div>

        <!-- 勤怠カレンダー -->
        <div class="overflow-x-auto mt-4">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th class="text-center">日</th>
                <th class="text-center">月</th>
                <th class="text-center">火</th>
                <th class="text-center">水</th>
                <th class="text-center">木</th>
                <th class="text-center">金</th>
                <th class="text-center">土</th>
              </tr>
            </thead>
            <tbody>
              {% for week in calendar_data %}
              <tr>
                {% for day in week %}
                {% if day %}
                <td class="p-0">
                  <div
                    class="calendar-day p-2 min-h-16 flex flex-col h-full {% if day.date in user_dates %}has-data{% endif %}">
                    <div class="flex justify-between items-start mb-1">
                      <span class="font-semibold">{{ day.day }}</span>
                      <div x-data="{ open: false }">
                        <button @click="open = true"
                          class="btn btn-xs btn-ghost btn-circle opacity-50 hover:opacity-100">
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-3 h-3">
                            <path stroke-linecap="round" stroke-linejoin="round"
                              d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                          </svg>
                        </button>

                        <!-- 編集モーダル -->
                        <div x-show="open" style="display:none;"
                          class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50">
                          <div class="bg-base-100 p-6 rounded-lg shadow-xl max-w-md w-full" @click.away="open = false"
                            @click.stop>
                            <h3 class="font-bold text-lg mb-2">{{ day.date }} の勤務場所を編集</h3>
                            <p class="text-sm mb-4">{{ user_name }} ({{ user_id }})さんの勤務場所を選択してください</p>

                            <form action="/api/attendance/update" method="post" class="space-y-4">
                              <input type="hidden" name="user_id" value="{{ user_id }}">
                              <input type="hidden" name="date" value="{{ day.date }}">

                              <div class="form-control">
                                <select name="location" class="select select-bordered w-full">
                                  <option value="">未設定</option>
                                  {% for location_type in location_types %}
                                  <option value="{{ location_type }}" {% if day.date in user_locations and
                                    user_locations[day.date]==location_type %}selected{% endif %}>
                                    {{ location_type }}
                                  </option>
                                  {% endfor %}
                                </select>
                              </div>

                              <div class="flex justify-end space-x-2">
                                <button type="button" class="btn btn-outline btn-sm"
                                  @click="open = false">キャンセル</button>
                                <button type="submit" class="btn btn-primary btn-sm">保存</button>
                              </div>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="flex-grow flex items-center justify-center">
                      {% if day.date in user_locations %}
                      <span class="badge badge-lg {{ location_styles[user_locations[day.date]] }} text-sm px-3 py-3">
                        {{ user_locations[day.date] }}
                      </span>
                      {% endif %}
                    </div>
                  </div>
                </td>
                {% else %}
                <td></td>
                {% endif %}
                {% endfor %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="flex justify-between items-center mt-4">
          <a href="/attendance" class="btn btn-outline">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="w-5 h-5 mr-1">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" />
            </svg>
            戻る
          </a>
        </div>
      </div>
    </div>
  </main>

  <!-- カレンダーのスタイル -->
  <style>
    .calendar-day {
      transition: all 0.2s ease;
      min-height: 5rem;
    }

    .calendar-day:hover {
      background-color: rgba(var(--color-primary) / 0.1);
    }

    .has-data {
      background-color: rgba(var(--color-primary) / 0.05);
    }
  </style>

  <!-- JavaScript -->
  <script>
    // ここにJavaScriptコードを追加（必要な場合）
  </script>
</body>

</html>